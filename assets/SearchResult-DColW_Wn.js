import{f as V,u as W,g as X,h as Z,j as ee,t as se,i as le,k as L,l as k,m as e,n as ae,p as te,s as oe,R as $,q as re,v as ie,x as ce,y as ue,z as ne,A as I,B as T,C as he,D as me,E as de,F as ve,L as ye,G as pe,H as _e,I as fe,J as M,K as ge,M as x}from"./app-DKm1uEzQ.js";const He=["/CHANGELOG.html","/CHANGELOG_old.html","/","/before_school/common_questions.html","/before_school/cost.html","/before_school/goto_school.html","/before_school/military_training.html","/before_school/school_readiness.html","/before_school/school_register.html","/doc_related/calender.html","/doc_related/copyright_statements.html","/doc_related/document_introduction.html","/doc_related/epilogue.html","/doc_related/thank_lists.html","/in_school/campus_fuyanshan/dormitory_fuyanshan.html","/in_school/campus_fuyanshan/school_life_fuyanshan.html","/in_school/campus_fuyanshan/summary_fuyanshan.html","/in_school/campus_yuhe/dormitory_yuhe.html","/in_school/campus_yuhe/school_life_yuhe.html","/in_school/campus_yuhe/summary_yuhe.html","/in_school/further_education/employment.html","/in_school/life/security.html","/in_school/life/study.html","/in_school/summary/community_summary.html","/in_school/tutorial/common_app.html","/in_school/tutorial/common_public_accounts.html","/in_school/tutorial/common_web.html","/in_school/tutorial/life.html","/in_school/tutorial/others.html","/in_school/tutorial/ppt.html","/in_school/tutorial/recommand_res.html","/in_school/tutorial/study.html","/in_school/campus_fuyanshan/maps/map_ABCDEF.html","/in_school/campus_fuyanshan/maps/map_full.html","/in_school/campus_fuyanshan/maps/map_hospital.html","/in_school/campus_fuyanshan/maps/map_minxing.html","/in_school/campus_yuhe/maps/map_full.html","/in_school/campus_yuhe/maps/map_hospital.html","/in_school/campus_yuhe/maps/map_renmin.html","/404.html"],be="SLIMSEARCH_QUERY_HISTORY",_=M(be,[]),ke=()=>{const{queryHistoryCount:t}=x;return{enabled:t>0,queryHistories:_,addQueryHistory:c=>{_.value=Array.from(new Set([c,..._.value.slice(0,t-1)]))},removeQueryHistory:c=>{_.value=[..._.value.slice(0,c),..._.value.slice(c+1)]}}},A=t=>He[t.id]+("anchor"in t?`#${t.anchor}`:""),xe="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:G}=x,f=M(xe,[]),Re=()=>({enabled:G>0,resultHistories:f,addResultHistory:i=>{{const c={link:A(i),display:i.display};"header"in i&&(c.header=i.header),f.value=[c,...f.value.slice(0,G-1)]}},removeResultHistory:i=>{f.value=[...f.value.slice(0,i),...f.value.slice(i+1)]}}),we=t=>{const{page:i,routeLocale:c}=he(),R=me(),o=L(0),g=k(()=>o.value>0),h=de([]);return ve(()=>{const{search:w,terminate:v}=ye(),H=_e(y=>{const{resultsFilter:Q=a=>a,querySplitter:p,suggestionsFilter:D,...r}=R.value;y?(o.value+=1,w(y,c.value,r).then(a=>Q(a,y,c.value,i.value)).then(a=>{o.value-=1,h.value=a}).catch(a=>{console.warn(a),o.value-=1,o.value||(h.value=[])})):h.value=[]},x.searchDelay-x.suggestDelay,{maxWait:5e3});pe([t,c],([y])=>H(y.join(" "))),fe(()=>{v()})}),{isSearching:g,results:h}};var qe=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:i}){const c=W(),R=X(),o=Z(ee),{addQueryHistory:g,queryHistories:h,removeQueryHistory:w}=ke(),{resultHistories:v,addResultHistory:H,removeResultHistory:y}=Re(),Q=se(t,"queries"),{results:p,isSearching:D}=we(Q),r=le({isQuery:!0,index:0}),a=L(0),m=L(0),E=k(()=>h.value.length>0||v.value.length>0),q=k(()=>p.value.length>0),C=k(()=>p.value[a.value]||null),O=()=>{const{isQuery:s,index:l}=r;l===0?(r.isQuery=!s,r.index=s?v.value.length-1:h.value.length-1):r.index=l-1},j=()=>{const{isQuery:s,index:l}=r;l===(s?h.value.length-1:v.value.length-1)?(r.isQuery=!s,r.index=0):r.index=l+1},U=()=>{a.value=a.value>0?a.value-1:p.value.length-1,m.value=C.value.contents.length-1},B=()=>{a.value=a.value<p.value.length-1?a.value+1:0,m.value=0},P=()=>{m.value<C.value.contents.length-1?m.value+=1:B()},Y=()=>{m.value>0?m.value-=1:U()},S=s=>s.map(l=>ge(l)?l:e(l[0],l[1])),N=s=>{if(s.type==="customField"){const l=ue[s.index]||"$content",[d,u=""]=ne(l)?l[R.value].split("$content"):l.split("$content");return s.display.map(n=>e("div",S([d,...n,u])))}return s.display.map(l=>e("div",S(l)))},b=()=>{a.value=0,m.value=0,i("updateQuery",""),i("close")},z=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},o.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},h.value.map((s,l)=>{const d=r.isQuery&&r.index===l;return e("li",{class:["slimsearch-record-matches",{active:d}],role:"option","aria-selected":d,onClick:()=>{i("updateQuery",s)}},e("div",[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:o.value.remove,"aria-label":o.value.remove,innerHTML:T,onClick:u=>{u.preventDefault(),u.stopPropagation(),w(l)}})]))}))])),J=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},o.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((s,l)=>{const d=!r.isQuery&&r.index===l;return e("li",{class:["slimsearch-record-matches",{active:d}],role:"option","aria-selected":d},e($,{to:s.link,onClick:()=>{b()}},()=>[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(u=>S(u)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:o.value.remove,"aria-label":o.value.remove,innerHTML:T,onClick:u=>{u.preventDefault(),u.stopPropagation(),y(l)}})]))}))]));return ae("keydown",s=>{if(t.isFocusing){if(q.value){if(s.key==="ArrowUp")Y();else if(s.key==="ArrowDown")P();else if(s.key==="Enter"){const l=C.value.contents[m.value];g(t.queries.join(" ")),H(l),c.push(A(l)),b()}}else if(s.key==="ArrowUp")O();else if(s.key==="ArrowDown")j();else if(s.key==="Enter"){const{index:l}=r;r.isQuery?(s.preventDefault(),i("updateQuery",h.value[l])):(c.push(v.value[l].link),b())}}}),te([a,m],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!q.value:!E.value}]},t.queries.length?D.value?e(oe,{hint:o.value.searching}):q.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:s,contents:l},d)=>{const u=a.value===d;return e("div",{class:["slimsearch-record",{active:u}],role:"group","aria-selected":u},[e("div",{class:"slimsearch-record-title"},s||o.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},l.map((n,K)=>{const F=u&&m.value===K;return e("li",{class:["slimsearch-record-matches",{active:F}],role:"option","aria-selected":F},e($,{to:A(n),onClick:()=>{g(t.queries.join(" ")),H(n),b()}},()=>[n.type==="text"?null:e(n.type==="title"?re:n.type==="heading"?ie:ce,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",N(n))])]))}))])})):o.value.emptyResult:E.value?[z(),J()]:o.value.emptyHistory)}});export{qe as default};
